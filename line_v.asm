.model small
.data
xOffset dw 0
bitmask db 8
x dw 100 ; line starting point
y1 dw 200 ; line starting point
y2 dw 480 ; max screen height
color db 12
len dw 640 ; line length

.code
drawpixelv proc near uses ax bx dx cx
    ; ?????????? ????????? ? ????????

    mov ax, y1        ; select y
    mov dx, 80          ; 640 / 80 = 8 -> ???????? ? ?????
    mul dx        ; ax = y * 80 -> ???????? ? ?????? ?? y

    mov bx, xOffset   ; ??????? ??????????? ?
    add bx, ax        ; x + y => ????????

    ;---????????? ????
    mov dx, 3CEh        ;????????? ?? ???????? ???????
    mov al, 8            ;????? ????????
    out dx, al            ;???????? ???
    inc dx                ;????????? ?? ??????? ??????
    mov al, bitmask            ;?????
    out dx, al            ;???????? ??????

    ; ?????? ?????. ??? ????? ?????, ? ?? ??????
    mov al, es:[bx]        ;?????? ?????????? ? ????????

    ;---????????? ???????? ????? ????? ??? ?????
    mov dx, 3C4h          ;????????? ?? ???????? ???????
    mov al, 2              ;?????? ???????? ????? ?????
    out dx, al             ;????????? ??????
    inc dx                ;????????? ?? ??????? ??????
    mov al, color        ;??? ?????
    out dx, al            ;???????? ??? ?????

    ;---?????? ?????
    mov al, 0FFh        ;????? ???????? ? ????????????? 7 ?????
    mov es:[bx], al        ;??????? ?????

    ret
    drawpixelv endp

start:
; Init Adapter

mov ax, @data        ; ????????? ???????? ??????
mov ds, ax        ; ????? ??????? ??
mov ax, 12h        ; VGA 640x480x256
int 10h                 ; ?????????? BIOS

; Init offset

mov ax, 0A000h    ; ????? ???????????
mov es, ax        ; ????????????? ?????????? ???????

mov bx, x
mov cl, bl
shr bx, 1               ; x // 8
shr bx, 1
shr bx, 1

mov xOffset, bx  ; ????????? ???????? ?

; ?????? ??? ???

and cl, 07h        ; bitmask mask
xor cl, 07h
mov ah, 01h
shl ah, cl
mov bitmask, ah

drawline: call drawpixelv
    inc y1
    mov bx, y1
    cmp bx, y2
    jle drawline

; ??????????

xor ax, ax        ;???????? ??????? ???????
int 16h

mov ax, 4C00h     ;????? ?? ??????? ? ?????????
int 21h           ;? ?????????? ?????
end start